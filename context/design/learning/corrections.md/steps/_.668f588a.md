---
timestamp: 'Wed Oct 29 2025 08:34:21 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251029_083421.0362e93b.md]]'
content_id: 668f588aeffe7cad2edd387dc6de34a81a9f3208649ebb81991d2c4a86671714
---

# Synchronization Specifications

These specifications describe the desired behavior of the application's API endpoints. They are grouped logically into files that handle authentication, file management, and sharing.

## file: src/syncs/auth.sync.ts

```sync
//-- User Registration --//
sync RegisterRequest
when
    Requesting.request (path: "/api/UserAuthentication/register", username, password): (request)
then
    UserAuthentication.register (username, password)

sync RegisterResponseSuccess
when
    Requesting.request (path: "/api/UserAuthentication/register"): (request)
    UserAuthentication.register (): (user)
then
    Requesting.respond (request, user)

sync RegisterResponseError
when
    Requesting.request (path: "/api/UserAuthentication/register"): (request)
    UserAuthentication.register (): (error)
then
    Requesting.respond (request, error)

//-- User Login & Session Creation (Composite Action) --//
sync LoginRequest
when
    Requesting.request (path: "/api/login", username, password): (request)
then
    UserAuthentication.login (username, password)

sync LoginSuccessCreatesSession
when
    UserAuthentication.login (): (user)
then
    Sessioning.create (user)

sync LoginResponseSuccess
when
    Requesting.request (path: "/api/login"): (request)
    // We match on the login success and the subsequent session creation it caused
    UserAuthentication.login (): (user)
    Sessioning.create (user): (session)
then
    Requesting.respond (request, session)

sync LoginResponseError
when
    Requesting.request (path: "/api/login"): (request)
    UserAuthentication.login (): (error)
then
    Requesting.respond (request, error)

//-- User Logout --//
sync LogoutRequest
when
    Requesting.request (path: "/api/logout", session): (request)
where
    // Authorize the request: a valid session must exist
    in Sessioning: _getUser(session) gets user
then
    Sessioning.delete (session)

sync LogoutResponse
when
    Requesting.request (path: "/api/logout"): (request)
    Sessioning.delete (): ()
then
    Requesting.respond (request, status: "logged_out")
```

## file: src/syncs/files.sync.ts

```sync
//-- Phase 1: Request Upload URL (Mimicked Passthrough) --//
sync RequestUploadURL
when
    Requesting.request (path: "/api/FileUploading/requestUploadURL", session, filename): (request)
where
    in Sessioning: _getUser(session) gets owner
then
    FileUploading.requestUploadURL (owner, filename)

sync RequestUploadURLResponse
when
    Requesting.request (path: "/api/FileUploading/requestUploadURL"): (request)
    FileUploading.requestUploadURL (): (file, uploadURL)
then
    Requesting.respond (request, file, uploadURL)

//-- Phase 2: Confirm Upload (Authorized) --//
sync ConfirmUploadRequest
when
    Requesting.request (path: "/api/FileUploading/confirmUpload", session, file): (request)
where
    // Authenticate and Authorize: user making request must own the file
    in Sessioning: _getUser(session) gets user
    in FileUploading: _getOwner(file) gets owner
    user is owner
then
    FileUploading.confirmUpload (file)

sync ConfirmUploadResponseSuccess
when
    Requesting.request (path: "/api/FileUploading/confirmUpload"): (request)
    FileUploading.confirmUpload (): ()
then
    Requesting.respond (request, status: "confirmed")

sync ConfirmUploadResponseError
when
    Requesting.request (path: "/api/FileUploading/confirmUpload"): (request)
    FileUploading.confirmUpload (): (error)
then
    Requesting.respond (request, error)

//-- List User's Files (Composite Semantic Request) --//
sync ListMyFilesRequest
when
    Requesting.request (path: "/api/my-files", session): (request)
where
    in Sessioning: _getUser(session) gets owner
    in FileUploading: _getFilesByOwner(owner) gets file, filename
    // Collect all file/filename pairs into a single 'results' array
    results is collection of {file, filename}
then
    Requesting.respond (request, results)

//-- Download a File (Complex Authorization) --//
sync DownloadFileRequest
when
    Requesting.request (path: "/api/download", session, file): (request)
where
    in Sessioning: _getUser(session) gets user
    in FileUploading: _getOwner(file) gets owner
    in Sharing: _isSharedWith(file, user) gets isShared
    // Authorization: User must be owner OR have the file shared with them
    user is owner OR isShared is true
    // If authorized, get the download URL
    in FileUploading: _getDownloadURL(file) gets downloadURL
then
    Requesting.respond (request, downloadURL)
```

## file: src/syncs/sharing.sync.ts

```sync
//-- Share a File (Multi-Concept Join) --//
sync ShareFileRequest
when
    Requesting.request (path: "/api/share", session, file, shareWithUsername): (request)
where
    // 1. Authenticate the requester
    in Sessioning: _getUser(session) gets requester
    // 2. Authorize: requester must own the file
    in FileUploading: _getOwner(file) gets owner
    requester is owner
    // 3. Find the target user to share with
    in UserAuthentication: _getUserByUsername(shareWithUsername) gets targetUser
then
    Sharing.shareWithUser (file, targetUser)

sync ShareFileResponse
when
    Requesting.request (path: "/api/share"): (request)
    Sharing.shareWithUser (): ()
then
    Requesting.respond (request, status: "shared")

//-- Revoke Access to a File --//
sync RevokeAccessRequest
when
    Requesting.request (path: "/api/revoke", session, file, revokeForUsername): (request)
where
    in Sessioning: _getUser(session) gets requester
    in FileUploading: _getOwner(file) gets owner
    requester is owner
    in UserAuthentication: _getUserByUsername(revokeForUsername) gets targetUser
then
    Sharing.revokeAccess (file, targetUser)

sync RevokeAccessResponse
when
    Requesting.request (path: "/api/revoke"): (request)
    Sharing.revokeAccess (): ()
then
    Requesting.respond (request, status: "revoked")
```

***
